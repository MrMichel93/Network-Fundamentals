# ğŸ“Š Module 06: Monitoring and Security - Diagrams

Visual representations to help understand monitoring, logging, observability, and security fundamentals.

---

# Part 1: Monitoring and Logging

## 1. Observability Pyramid

The three pillars of observability showing their relationship and scope:

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Tracing  â”‚  â† Most detailed, specific requests
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     Shows: Request flow, dependencies
        â”‚  Metrics  â”‚  â† Aggregated, time-series data
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     Shows: System health, trends
        â”‚   Logs    â”‚  â† Events, detailed context
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     Shows: What happened, when, why


Detailed View:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TRACING                          â”‚
â”‚  Distributed request tracking                       â”‚
â”‚                                                     â”‚
â”‚  Request ID: abc-123                                â”‚
â”‚  â”œâ”€ API Gateway (50ms)                             â”‚
â”‚  â”œâ”€ Auth Service (20ms)                            â”‚
â”‚  â”œâ”€ Database Query (100ms)                         â”‚
â”‚  â””â”€ Response (10ms)                                â”‚
â”‚  Total: 180ms                                       â”‚
â”‚                                                     â”‚
â”‚  Use: Performance debugging, bottleneck analysis    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–²
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    METRICS                          â”‚
â”‚  Quantitative measurements over time                â”‚
â”‚                                                     â”‚
â”‚  CPU Usage: 45%                                     â”‚
â”‚  Memory: 2.1GB / 4GB                               â”‚
â”‚  Request Rate: 1,234 req/min                       â”‚
â”‚  Error Rate: 0.5%                                  â”‚
â”‚  Response Time: p95 = 250ms                        â”‚
â”‚                                                     â”‚
â”‚  Use: Alerting, dashboards, capacity planning       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–²
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LOGS                            â”‚
â”‚  Discrete events with context                       â”‚
â”‚                                                     â”‚
â”‚  2024-12-19 10:30:15 INFO User login successful     â”‚
â”‚  2024-12-19 10:30:16 ERROR DB connection timeout    â”‚
â”‚  2024-12-19 10:30:17 WARN High memory usage         â”‚
â”‚                                                     â”‚
â”‚  Use: Debugging, audit trails, troubleshooting      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


How They Work Together:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Problem Detected
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   METRICS    â”‚  High error rate detected!
â”‚ Error: 5%    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ (Investigate)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     LOGS     â”‚  Find error messages
â”‚ "Timeout"    â”‚  Identify patterns
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼ (Deep dive)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TRACING    â”‚  Trace slow requests
â”‚ DB latency   â”‚  Find root cause
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Log Aggregation Flow

How logs flow from containers through collection to visualization:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Application Containers                    â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  web-1   â”‚  â”‚  api-1   â”‚  â”‚  worker  â”‚           â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚           â”‚
â”‚  â”‚ stdout   â”‚  â”‚ stdout   â”‚  â”‚ stdout   â”‚           â”‚
â”‚  â”‚ stderr   â”‚  â”‚ stderr   â”‚  â”‚ stderr   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â”‚       â”‚             â”‚             â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
        â”‚   Container Logs (JSON)   â”‚
        â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Log Collector         â”‚
        â”‚   (Fluentd / Promtail)  â”‚
        â”‚                         â”‚
        â”‚  - Parse logs           â”‚
        â”‚  - Add metadata         â”‚
        â”‚  - Filter/Transform     â”‚
        â”‚  - Buffer               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Log Storage           â”‚
        â”‚   (Loki / Elasticsearch)â”‚
        â”‚                         â”‚
        â”‚  - Index logs           â”‚
        â”‚  - Store efficiently    â”‚
        â”‚  - Enable search        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Visualization         â”‚
        â”‚   (Grafana / Kibana)    â”‚
        â”‚                         â”‚
        â”‚  - Query logs           â”‚
        â”‚  - Display dashboards   â”‚
        â”‚  - Alert on patterns    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Users   â”‚
              â”‚ Developersâ”‚
              â”‚    Ops    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Detailed Data Flow:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Container:
  app.log("User login: user123")
        â”‚
        â–¼
  {"timestamp": "2024-12-19T10:30:15Z",
   "level": "INFO",
   "message": "User login: user123",
   "container": "api-1"}
        â”‚
        â–¼
Collector (adds metadata):
  {"timestamp": "2024-12-19T10:30:15Z",
   "level": "INFO",
   "message": "User login: user123",
   "container": "api-1",
   "host": "node-1",
   "pod": "api-deployment-abc123",
   "namespace": "production"}
        â”‚
        â–¼
Storage (indexed):
  - Time-based index
  - Full-text search
  - Compressed storage
        â”‚
        â–¼
Query & Display:
  Show all ERROR logs from last hour
  Group by container
  Chart error rate over time


Log Levels and Routing:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Application produces logs:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DEBUG   â”‚â”€â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   INFO   â”‚â”€â”€â”¼â”€â”€â”€â–¶ Standard output
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   WARN   â”‚â”€â”€â”˜
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ERROR   â”‚â”€â”€â”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â–¶ Error output + Alert
â”‚  FATAL   â”‚â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Log Format Best Practices:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Structured Logging (JSON):
{
  "timestamp": "2024-12-19T10:30:15Z",
  "level": "ERROR",
  "service": "api",
  "trace_id": "abc123",
  "user_id": "user789",
  "message": "Database connection failed",
  "error": {
    "type": "ConnectionError",
    "code": "ETIMEDOUT"
  }
}

Benefits:
âœ… Easy to parse
âœ… Filterable fields
âœ… Machine-readable
âœ… Queryable
```

---

## 3. Alert Flow

From metric threshold to notification:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Metric Collection                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
          â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
          â”‚           â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚Prometheusâ”‚  â”‚  Metrics â”‚
    â”‚ /Scrape  â”‚  â”‚ Exporter â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Store time-series data
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Evaluation  â”‚
    â”‚   Engine     â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Check alert rules
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Alert Rule         â”‚
    â”‚  IF cpu > 80%       â”‚
    â”‚  FOR 5 minutes      â”‚
    â”‚  THEN alert         â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
      â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
     No         Yes
      â”‚          â”‚
      â–¼          â–¼
   Monitor   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     ...     â”‚  FIRING    â”‚
             â”‚  Alert     â”‚
             â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Alert Manager  â”‚
          â”‚                â”‚
          â”‚ - Group alerts â”‚
          â”‚ - Deduplicate  â”‚
          â”‚ - Route        â”‚
          â”‚ - Throttle     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚          â”‚          â”‚
        â–¼          â–¼          â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Email  â”‚ â”‚ Slack  â”‚ â”‚PagerDutyâ”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚          â”‚          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  On-Call â”‚
            â”‚  Engineerâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Alert Severity Routing:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Alert Triggered            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚
        â–¼              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ CRITICAL â”‚   â”‚ WARNING  â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚              â”‚
        â–¼              â–¼
  Immediate      Aggregated
  Notification   (every 15 min)
        â”‚              â”‚
        â–¼              â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚PagerDuty â”‚   â”‚  Slack   â”‚
  â”‚  (Page)  â”‚   â”‚(Channel) â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Alert States:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Normal  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ Threshold exceeded
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pending â”‚  Wait for 'FOR' duration
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ Still firing
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Firing  â”‚  Send notifications
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ Condition resolved
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Resolved â”‚  Send recovery notification
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Alert Example:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Rule:
groups:
  - name: api_alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_errors[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High error rate"
          description: "Error rate is {{ $value }}"

Lifecycle:
  T+0:00  Error rate spikes to 7%
  T+0:05  Alert enters PENDING (waiting)
  T+5:00  Alert fires (sustained 5 min)
  T+5:01  Notification sent
  T+8:00  Engineer acknowledges
  T+10:00 Issue fixed, rate drops
  T+10:01 Alert resolved
  T+10:02 Recovery notification sent


Alert Grouping:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Multiple similar alerts:
â”œâ”€ api-1: High CPU
â”œâ”€ api-2: High CPU
â”œâ”€ api-3: High CPU
â””â”€ api-4: High CPU
      â”‚
      â–¼
Grouped into single notification:
"API Cluster: High CPU (4 instances)"
```

---

## 4. Health Check Decision Tree

Service health check logic and decision making:

```
                Start Health Check
                        â”‚
                        â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  HTTP Request â”‚
                â”‚  GET /health  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Response?    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
               Yes              No
                â”‚                â”‚
                â–¼                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚Check code â”‚    â”‚   Timeout   â”‚
        â”‚           â”‚    â”‚   (30s)     â”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”          â”‚
      200 OK       Other        â”‚
        â”‚            â”‚          â”‚
        â–¼            â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Check bodyâ”‚  â”‚  Unhealthyâ”‚  â”‚Unreachableâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚              â”‚
     â–¼             â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚              â”‚
â”‚ Valid    â”‚       â”‚              â”‚
â”‚ JSON?    â”‚       â”‚              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚              â”‚
     â”‚             â”‚              â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”        â”‚              â”‚
â”‚         â”‚        â”‚              â”‚
Yes       No       â”‚              â”‚
â”‚         â”‚        â”‚              â”‚
â–¼         â–¼        â”‚              â”‚
Check   Unhealthy  â”‚              â”‚
all                â”‚              â”‚
deps               â”‚              â”‚
â”‚                  â”‚              â”‚
â–¼                  â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚              â”‚
â”‚Database  â”‚       â”‚              â”‚
â”‚  OK?     â”‚       â”‚              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚              â”‚
     â”‚             â”‚              â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”        â”‚              â”‚
â”‚         â”‚        â”‚              â”‚
Yes       No       â”‚              â”‚
â”‚         â”‚        â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                  â”‚              â”‚
â–¼                  â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HEALTHY  â”‚  â”‚     UNHEALTHY       â”‚
â”‚          â”‚  â”‚  (Remove from pool) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚
     â–¼                    â–¼
Route traffic      Stop routing
to service         Retry health check


Health Check Response Example:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

GET /health

Response: 200 OK
{
  "status": "healthy",
  "timestamp": "2024-12-19T10:30:15Z",
  "checks": {
    "database": {
      "status": "up",
      "responseTime": "15ms"
    },
    "redis": {
      "status": "up",
      "responseTime": "5ms"
    },
    "disk": {
      "status": "warning",
      "usage": "85%"
    }
  },
  "uptime": "3d 2h 15m",
  "version": "2.1.0"
}


Health States:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Startingâ”‚  Initial state
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ First successful check
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Healthy â”‚  Accepting traffic
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ Check fails
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Degraded â”‚  Still serving (warning)
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ Multiple failures
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Unhealthy â”‚  Remove from rotation
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ Checks pass again
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Recoveringâ”‚  Grace period
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚ Stable
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Healthy  â”‚  Back in rotation
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Docker Health Check:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Dockerfile:
HEALTHCHECK --interval=30s --timeout=3s --retries=3 \
  CMD curl -f http://localhost:3000/health || exit 1

Behavior:
T+0s    Container starts
T+30s   First health check
T+30s   âœ“ Passed â†’ healthy
T+60s   âœ— Failed â†’ unhealthy (1/3)
T+90s   âœ— Failed â†’ unhealthy (2/3)
T+120s  âœ— Failed â†’ unhealthy (3/3)
        Container marked unhealthy
        (restart policy may restart)
```

---

# Part 2: Security Basics

## 5. Security Layers

Defense in depth: multiple layers of security:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Infrastructure Security        â”‚
â”‚  â€¢ Network segmentation             â”‚
â”‚  â€¢ Firewalls                        â”‚
â”‚  â€¢ DDoS protection                  â”‚
â”‚  â€¢ Physical security                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Container Security        â”‚ â”‚
â”‚  â”‚  â€¢ Image scanning             â”‚ â”‚
â”‚  â”‚  â€¢ Runtime security           â”‚ â”‚
â”‚  â”‚  â€¢ Resource limits            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Application Security  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Input validation     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Authentication       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Authorization        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Code Security   â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ SAST scanning  â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Dependency     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚    checks         â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Code review    â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Layer-by-Layer Breakdown:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. CODE LAYER:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Secure coding practices    â”‚
   â”‚ â€¢ No hardcoded secrets       â”‚
   â”‚ â€¢ Input validation           â”‚
   â”‚ â€¢ Output encoding            â”‚
   â”‚ â€¢ Dependency scanning        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
2. APPLICATION LAYER:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Authentication (JWT, OAuth)â”‚
   â”‚ â€¢ Authorization (RBAC)       â”‚
   â”‚ â€¢ Session management         â”‚
   â”‚ â€¢ API rate limiting          â”‚
   â”‚ â€¢ Error handling             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
3. CONTAINER LAYER:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Minimal base images        â”‚
   â”‚ â€¢ Non-root user              â”‚
   â”‚ â€¢ Read-only filesystem       â”‚
   â”‚ â€¢ Security scanning          â”‚
   â”‚ â€¢ Resource limits            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
4. INFRASTRUCTURE LAYER:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ â€¢ Network policies           â”‚
   â”‚ â€¢ Firewall rules             â”‚
   â”‚ â€¢ TLS/SSL encryption         â”‚
   â”‚ â€¢ Intrusion detection        â”‚
   â”‚ â€¢ Access controls            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Attack vs Defense:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Attack attempt at each layer:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQL Injection Attack                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: WAF blocks known patterns â”‚ â† Blocked
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ (if bypassed)
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 2: Input validation rejects  â”‚ â† Blocked
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ (if bypassed)
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 3: Prepared statements safe  â”‚ â† Blocked
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ (if bypassed)
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 4: DB permissions limited    â”‚ â† Limited damage
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Multiple layers = Defense in depth
```

---

## 6. Secret Management Flow

Proper handling of sensitive credentials:

```
âŒ WRONG WAY (Security Risk):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Code:
const password = "mypassword123"  â† Hardcoded
    â”‚
    â–¼
Git commit
    â”‚
    â–¼
Public repository  â† Exposed!
    â”‚
    â–¼
Attackers find it  â† Compromised


âœ… RIGHT WAY (Secure):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Development:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  .env file   â”‚  â† Not in Git (.gitignore)
â”‚  LOCAL only  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Application  â”‚  â† Reads from environment
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Production:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Secret Store                â”‚
â”‚  (Vault, AWS Secrets, Azure KeyVault)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 1. Authenticate
             â”‚
        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚   CI/CD   â”‚
        â”‚  Pipeline â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 2. Fetch secrets
             â”‚
        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚ Container â”‚
        â”‚Environmentâ”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 3. Use secrets
             â”‚
        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
        â”‚Applicationâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Secret Lifecycle:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generation  â”‚  Create strong secret
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Storage    â”‚  Store in vault
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Distribution â”‚  Inject at runtime
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Rotation   â”‚  Periodically change
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Revocation â”‚  Invalidate when needed
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Docker Secrets Example:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

docker-compose.yml:
services:
  api:
    image: myapp
    secrets:
      - db_password
      - api_key

secrets:
  db_password:
    external: true
  api_key:
    external: true

Application reads from:
  /run/secrets/db_password
  /run/secrets/api_key


Environment Variables (Injected):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Secret Store   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    CI/CD        â”‚
â”‚  - Fetch        â”‚
â”‚  - Inject       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Container     â”‚
â”‚   ENV:          â”‚
â”‚   DB_PASS=***   â”‚
â”‚   API_KEY=***   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Access Control:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Secret Store:
â”œâ”€ Production secrets
â”‚  â””â”€ Access: Only prod pipeline
â”œâ”€ Staging secrets
â”‚  â””â”€ Access: Staging + Prod
â””â”€ Development secrets
   â””â”€ Access: All developers

Principle of Least Privilege:
  Only give access to what's needed
```

---

## 7. Security Scanning Pipeline

Automated security checks throughout development:

```
Code â†’ SAST â†’ Container Scan â†’ DAST â†’ Production
  â†“      â†“          â†“            â†“         â†“
Check  Check      Check        Check    Monitor
code   deps       image        running  runtime
                                app


Detailed Pipeline:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Security Scanning Stages                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Stage 1: Source Code (SAST)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Developer writes code     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  git push                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SAST Scanner              â”‚
â”‚  (SonarQube, CodeQL)       â”‚
â”‚                            â”‚
â”‚  Checks for:               â”‚
â”‚  â€¢ SQL injection           â”‚
â”‚  â€¢ XSS vulnerabilities     â”‚
â”‚  â€¢ Hardcoded secrets       â”‚
â”‚  â€¢ Insecure functions      â”‚
â”‚  â€¢ Code smells             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
       Pass      Fail
        â”‚          â”‚
        â”‚     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
        â”‚     â”‚ Block PR â”‚
        â”‚     â”‚ Notify   â”‚
        â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼

Stage 2: Dependencies (SCA)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dependency Scanner        â”‚
â”‚  (Snyk, Dependabot)        â”‚
â”‚                            â”‚
â”‚  Checks for:               â”‚
â”‚  â€¢ Known CVEs              â”‚
â”‚  â€¢ Outdated packages       â”‚
â”‚  â€¢ License issues          â”‚
â”‚  â€¢ Malicious packages      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
       Pass      Fail
        â”‚          â”‚
        â”‚     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
        â”‚     â”‚  Alert   â”‚
        â”‚     â”‚ Create   â”‚
        â”‚     â”‚  Issue   â”‚
        â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼

Stage 3: Container Image
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Build Docker Image        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Container Scanner         â”‚
â”‚  (Trivy, Clair)            â”‚
â”‚                            â”‚
â”‚  Checks for:               â”‚
â”‚  â€¢ OS vulnerabilities      â”‚
â”‚  â€¢ Package vulnerabilities â”‚
â”‚  â€¢ Misconfigurations       â”‚
â”‚  â€¢ Secrets in layers       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
       Pass      Fail
        â”‚          â”‚
        â”‚     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
        â”‚     â”‚  Block   â”‚
        â”‚     â”‚  Deploy  â”‚
        â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼

Stage 4: Runtime (DAST)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Deploy to Staging         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dynamic Scanner           â”‚
â”‚  (OWASP ZAP, Burp)         â”‚
â”‚                            â”‚
â”‚  Tests:                    â”‚
â”‚  â€¢ Authentication          â”‚
â”‚  â€¢ Authorization           â”‚
â”‚  â€¢ Input validation        â”‚
â”‚  â€¢ API security            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
       Pass      Fail
        â”‚          â”‚
        â”‚     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
        â”‚     â”‚ Review   â”‚
        â”‚     â”‚ Manually â”‚
        â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Deploy to Production      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼

Stage 5: Production Monitoring
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Runtime Security          â”‚
â”‚  (Falco, Sysdig)           â”‚
â”‚                            â”‚
â”‚  Monitors:                 â”‚
â”‚  â€¢ Suspicious activity     â”‚
â”‚  â€¢ Unauthorized access     â”‚
â”‚  â€¢ Resource abuse          â”‚
â”‚  â€¢ Anomalies               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Severity Handling:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vulnerability Found      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚             â”‚          â”‚         â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚CRITICAL  â”‚ â”‚  HIGH    â”‚ â”‚ MEDIUM â”‚ â”‚  LOW   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚             â”‚          â”‚        â”‚
      â–¼             â–¼          â–¼        â–¼
  Block        Block      Create    Track
  Deploy       Deploy     Ticket    Only
  Alert        Review     (5 days)
  (Immediate)  Required


Scan Results Example:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Vulnerability Report:
â”œâ”€ CRITICAL: SQL Injection in auth.js:45
â”‚  â””â”€ Action: Block deployment
â”œâ”€ HIGH: XSS vulnerability in comments
â”‚  â””â”€ Action: Require fix + review
â”œâ”€ MEDIUM: Outdated dependency (lodash 4.17.15)
â”‚  â””â”€ Action: Create update ticket
â””â”€ LOW: Weak password policy
   â””â”€ Action: Add to backlog
```

---

## 8. Attack Surface Map

Identifying and protecting potential vulnerability points:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Application Attack Surface              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External Facing:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

                    Internet
                        â”‚
                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   CDN / WAF       â”‚ â† 1. DDoS protection
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      Rate limiting
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Load Balancer    â”‚ â† 2. SSL termination
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      TLS 1.3
                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
              â”‚               â”‚
              â–¼               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Web    â”‚     â”‚   API   â”‚ â† 3. Authentication
        â”‚ Server  â”‚     â”‚ Server  â”‚      Authorization
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      Input validation
             â”‚               â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Application   â”‚ â† 4. Business logic
            â”‚     Layer      â”‚      Session mgmt
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Databaseâ”‚  â”‚ Cache  â”‚  â”‚ Queue  â”‚ â† 5. Data layer
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      Encryption
                                             Access control


Attack Vectors by Component:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Web/API Entry Points:
   â”œâ”€ SQL Injection
   â”œâ”€ XSS (Cross-Site Scripting)
   â”œâ”€ CSRF (Cross-Site Request Forgery)
   â”œâ”€ Authentication bypass
   â”œâ”€ Authorization flaws
   â”œâ”€ API abuse
   â””â”€ DDoS attacks

2. Application Layer:
   â”œâ”€ Business logic flaws
   â”œâ”€ Insecure deserialization
   â”œâ”€ XML external entities (XXE)
   â”œâ”€ Server-side request forgery
   â””â”€ Insufficient logging

3. Infrastructure:
   â”œâ”€ Misconfigured containers
   â”œâ”€ Exposed management ports
   â”œâ”€ Weak network policies
   â”œâ”€ Unpatched systems
   â””â”€ Insecure secrets

4. Dependencies:
   â”œâ”€ Vulnerable libraries
   â”œâ”€ Supply chain attacks
   â”œâ”€ Outdated frameworks
   â””â”€ Malicious packages


Defense Mapping:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Attack Vector         Defense
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€
SQL Injection    â†’   Parameterized queries
                     Input validation
                     Least privilege DB user

XSS              â†’   Output encoding
                     Content Security Policy
                     Input sanitization

Authentication   â†’   Strong password policy
                     MFA (Multi-factor auth)
                     Session timeout
                     Secure password storage

Authorization    â†’   RBAC (Role-based)
                     Principle of least privilege
                     Regular access reviews

DDoS             â†’   Rate limiting
                     WAF (Web Application Firewall)
                     CDN with DDoS protection

Data Exposure    â†’   Encryption at rest
                     Encryption in transit (TLS)
                     Data classification
                     Access logging


Threat Modeling Process:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Identify Assets
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User data    â”‚
   â”‚ API keys     â”‚
   â”‚ Databases    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Identify Threats
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Data breach  â”‚
   â”‚ DoS attack   â”‚
   â”‚ Unauthorized â”‚
   â”‚ access       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Assess Risk
   Impact Ã— Likelihood = Risk Score
   
4. Implement Controls
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Preventive   â”‚
   â”‚ Detective    â”‚
   â”‚ Corrective   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. Monitor & Review
   Continuous improvement


Security Checklist:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Application:
â”œâ”€ [ ] Input validation on all inputs
â”œâ”€ [ ] Output encoding for XSS prevention
â”œâ”€ [ ] Parameterized SQL queries
â”œâ”€ [ ] Strong authentication
â”œâ”€ [ ] Proper authorization checks
â”œâ”€ [ ] Secure session management
â”œâ”€ [ ] HTTPS everywhere (TLS 1.3)
â”œâ”€ [ ] Security headers configured
â””â”€ [ ] Error handling (no info leak)

Infrastructure:
â”œâ”€ [ ] Containers run as non-root
â”œâ”€ [ ] Regular security scans
â”œâ”€ [ ] Network segmentation
â”œâ”€ [ ] Firewall rules configured
â”œâ”€ [ ] Secrets in vault (not code)
â”œâ”€ [ ] Monitoring and alerting
â”œâ”€ [ ] Incident response plan
â””â”€ [ ] Regular updates/patches

Development:
â”œâ”€ [ ] Code review process
â”œâ”€ [ ] SAST in CI/CD pipeline
â”œâ”€ [ ] Dependency scanning
â”œâ”€ [ ] Security training for team
â””â”€ [ ] Secure coding standards
```

---

## Summary

These diagrams illustrate:
- âœ… Observability pyramid: logs, metrics, tracing
- âœ… Log aggregation from containers to visualization
- âœ… Alert flow from detection to notification
- âœ… Health check decision logic
- âœ… Security layers (defense in depth)
- âœ… Proper secret management practices
- âœ… Security scanning throughout CI/CD
- âœ… Attack surface identification and protection

**Monitoring Key Concepts:**
- **Logs**: What happened (events, context)
- **Metrics**: How much/how many (quantitative)
- **Traces**: End-to-end request flow
- **Alerts**: Automated notifications
- **Health Checks**: Service availability verification

**Security Key Concepts:**
- **Defense in Depth**: Multiple security layers
- **Least Privilege**: Minimum necessary access
- **Security Scanning**: Automated vulnerability detection
- **Secret Management**: Secure credential handling
- **Attack Surface**: All potential entry points

**Best Practices:**
- Implement structured logging
- Set up meaningful alerts (avoid noise)
- Use health checks for all services
- Scan at every stage of development
- Never commit secrets to code
- Keep dependencies updated
- Monitor production continuously
- Have an incident response plan

**Next Steps:**
- Set up logging for your application
- Implement health checks
- Configure alerts for critical metrics
- Scan your code and containers
- Secure your secrets properly
- Complete the [exercises](./exercises.md)
